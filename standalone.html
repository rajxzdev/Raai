<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAAI - Advanced AI Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #a855f7;
            --primary-dark: #9333ea;
            --secondary: #06b6d4;
            --accent: #f472b6;
            --bg-dark: #0a0a0f;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.06);
            --border: rgba(255, 255, 255, 0.08);
            --text: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: float 20s ease-in-out infinite;
        }

        .bg-orb-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #a855f7, #6366f1);
            top: -200px;
            left: -200px;
            animation-delay: 0s;
        }

        .bg-orb-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, #06b6d4, #0ea5e9);
            bottom: -150px;
            right: -150px;
            animation-delay: -7s;
        }

        .bg-orb-3 {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #f472b6, #ec4899);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -14s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(50px, -50px) scale(1.1); }
            50% { transform: translate(-30px, 30px) scale(0.95); }
            75% { transform: translate(40px, 40px) scale(1.05); }
        }

        /* Layout */
        .app-container {
            position: relative;
            z-index: 1;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(15, 15, 25, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 0;
            border-right: none;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
            animation: pulse-glow 3s ease-in-out infinite;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4); }
            50% { box-shadow: 0 4px 40px rgba(168, 85, 247, 0.7); }
        }

        .logo-text h1 {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding: 0 12px;
        }

        .nav-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .nav-btn:hover {
            background: var(--bg-card-hover);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(6, 182, 212, 0.2));
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .nav-btn-icon {
            font-size: 18px;
        }

        .new-chat-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
        }

        .chat-history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
        }

        .chat-history-item:hover {
            background: var(--bg-card-hover);
        }

        .chat-history-item.active {
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .chat-history-title {
            font-size: 13px;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .chat-delete-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            padding: 4px;
        }

        .chat-history-item:hover .chat-delete-btn {
            opacity: 1;
        }

        .chat-delete-btn:hover {
            color: #ef4444;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        .admin-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            color: var(--primary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-btn:hover {
            background: rgba(168, 85, 247, 0.2);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
        }

        /* Header */
        .main-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            background: rgba(15, 15, 25, 0.6);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .toggle-sidebar-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .toggle-sidebar-btn:hover {
            background: var(--bg-card-hover);
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
        }

        .header-title span {
            color: var(--primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            font-size: 12px;
            color: #22c55e;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Chat View */
        .chat-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin-bottom: 24px;
            box-shadow: 0 10px 50px rgba(168, 85, 247, 0.4);
            animation: float-icon 3s ease-in-out infinite;
        }

        .welcome-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 30px;
        }

        @keyframes float-icon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--text), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--text-muted);
            max-width: 500px;
            line-height: 1.6;
        }

        .suggestion-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 32px;
            max-width: 700px;
            width: 100%;
        }

        .suggestion-card {
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .suggestion-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.2);
        }

        .suggestion-card-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .suggestion-card-text {
            font-size: 13px;
            color: var(--text);
            line-height: 1.5;
        }

        /* Message Bubbles */
        .message {
            display: flex;
            gap: 12px;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .message-bubble {
            padding: 14px 18px;
            border-radius: 18px;
            line-height: 1.6;
            font-size: 14px;
            overflow: hidden;
            min-width: 0;
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .message.assistant .message-bubble {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-top-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-top-right-radius: 4px;
        }

        .message-bubble p {
            margin-bottom: 12px;
        }

        .message-bubble p:last-child {
            margin-bottom: 0;
        }

        .message-bubble strong {
            font-weight: 600;
            color: var(--primary);
        }

        .message.user .message-bubble strong {
            color: white;
        }

        .message-bubble ul, .message-bubble ol {
            margin: 12px 0;
            padding-left: 20px;
        }

        .message-bubble li {
            margin-bottom: 6px;
        }

        /* Code Blocks */
        .code-block-wrapper {
            margin: 12px 0;
            border-radius: 12px;
            overflow: hidden;
            background: #1a1a2e;
            border: 1px solid var(--border);
        }

        .code-block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid var(--border);
        }

        .code-block-lang {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .copy-code-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(168, 85, 247, 0.2);
            border: none;
            border-radius: 6px;
            color: var(--primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-code-btn:hover {
            background: rgba(168, 85, 247, 0.3);
        }

        .copy-code-btn.copied {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .code-block-content {
            overflow-x: auto;
            max-height: 400px;
        }

        .code-block-content pre {
            margin: 0;
            padding: 16px;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #e2e8f0;
            white-space: pre;
        }

        .inline-code {
            background: rgba(168, 85, 247, 0.2);
            padding: 2px 8px;
            border-radius: 6px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            color: var(--primary);
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typing 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            padding: 20px 24px;
            background: rgba(15, 15, 25, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
        }

        .input-container {
            display: flex;
            gap: 12px;
            max-width: 900px;
            margin: 0 auto;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            align-items: flex-end;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            transition: all 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .input-wrapper textarea {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            resize: none;
            max-height: 150px;
            line-height: 1.5;
        }

        .input-wrapper textarea::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Image Generator View */
        .image-generator-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .image-gen-header {
            padding: 24px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .image-gen-header h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .image-gen-header p {
            color: var(--text-muted);
            font-size: 14px;
        }

        .image-gen-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .mode-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .mode-btn {
            padding: 12px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn:hover {
            background: var(--bg-card-hover);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
            color: white;
        }

        .prompt-input-area {
            max-width: 700px;
            margin: 0 auto 32px;
        }

        .prompt-input-wrapper {
            display: flex;
            gap: 12px;
        }

        .prompt-input {
            flex: 1;
            padding: 16px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .prompt-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .generate-btn {
            padding: 16px 28px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .generating-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Image Gallery */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .gallery-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .gallery-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            cursor: pointer;
        }

        .gallery-info {
            padding: 16px;
        }

        .gallery-prompt {
            font-size: 13px;
            color: var(--text);
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .gallery-actions {
            display: flex;
            gap: 8px;
        }

        .gallery-action-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-card-hover);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .gallery-action-btn:hover {
            background: rgba(168, 85, 247, 0.2);
            border-color: var(--primary);
        }

        /* Admin Panel Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            background: linear-gradient(135deg, rgba(20, 20, 35, 0.98), rgba(30, 30, 50, 0.98));
            border: 1px solid var(--border);
            border-radius: 24px;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(168, 85, 247, 0.1);
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close-btn {
            width: 36px;
            height: 36px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            color: #ef4444;
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .login-form {
            text-align: center;
        }

        .login-icon {
            font-size: 48px;
            margin-bottom: 20px;
            animation: float-icon 3s ease-in-out infinite;
        }

        .login-form h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .login-form > p {
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 24px;
        }

        .password-input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .password-input {
            width: 100%;
            padding: 14px 50px 14px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .password-input:focus {
            border-color: var(--primary);
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
        }

        .login-error {
            color: #ef4444;
            font-size: 13px;
            margin-top: 12px;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }

        /* Admin Settings Form */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text);
        }

        .settings-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .settings-input:focus {
            border-color: var(--primary);
        }

        .settings-description {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .logo-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .logo-option {
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logo-option:hover, .logo-option.active {
            border-color: var(--primary);
            background: rgba(168, 85, 247, 0.1);
        }

        .logo-option-title {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .emoji-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .emoji-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-card-hover);
            border: 2px solid transparent;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .emoji-btn:hover, .emoji-btn.active {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .file-upload-btn {
            width: 100%;
            padding: 20px;
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: var(--text-muted);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-upload-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .color-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            border-color: white;
            box-shadow: 0 0 20px currentColor;
        }

        .preview-card {
            padding: 20px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 16px;
            text-align: center;
        }

        .preview-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin: 0 auto 12px;
        }

        .preview-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 16px;
        }

        .preview-name {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .modal-footer button {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .save-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
        }

        .cancel-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .cancel-btn:hover {
            background: var(--bg-card-hover);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            animation: fadeIn 0.3s ease;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .lightbox-close:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 12px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 100;
                width: 280px;
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .suggestion-cards {
                grid-template-columns: 1fr;
            }

            .message {
                max-width: 95%;
            }

            .image-gallery {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
        <div class="bg-orb bg-orb-3"></div>
    </div>

    <!-- Main App -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo" id="sidebar-logo">ü§ñ</div>
                    <div class="logo-text">
                        <h1 id="sidebar-title">RAAI</h1>
                        <p>Advanced AI Assistant</p>
                    </div>
                </div>
            </div>

            <div class="sidebar-content">
                <button class="nav-btn new-chat-btn" onclick="newChat()">
                    <span class="nav-btn-icon">‚ú®</span>
                    Chat Baru
                </button>

                <nav class="nav-section">
                    <div class="nav-section-title">Menu</div>
                    <button class="nav-btn active" id="nav-chat" onclick="switchView('chat')">
                        <span class="nav-btn-icon">üí¨</span>
                        Chat AI
                    </button>
                    <button class="nav-btn" id="nav-image" onclick="switchView('image')">
                        <span class="nav-btn-icon">üé®</span>
                        Image Generator
                    </button>
                </nav>

                <nav class="nav-section">
                    <div class="nav-section-title">Riwayat Chat</div>
                    <div id="chat-history"></div>
                </nav>
            </div>

            <div class="sidebar-footer">
                <button class="admin-btn" onclick="openAdminPanel()">
                    <span>‚öôÔ∏è</span>
                    Admin Panel
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="toggle-sidebar-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h2 class="header-title">
                        <span id="header-ai-name">RAAI</span> AI
                    </h2>
                </div>
                <div class="header-right">
                    <div class="ai-status">
                        <div class="status-dot"></div>
                        Online
                    </div>
                </div>
            </header>

            <!-- Chat View -->
            <div class="chat-view" id="chat-view">
                <div class="messages-container" id="messages-container">
                    <!-- Welcome Screen -->
                    <div class="welcome-screen" id="welcome-screen">
                        <div class="welcome-icon" id="welcome-icon">ü§ñ</div>
                        <h1 class="welcome-title" id="welcome-title">Halo! Saya RAAI</h1>
                        <p class="welcome-subtitle">
                            AI Assistant cerdas yang bisa membantu menjawab pertanyaan, menulis kode, 
                            menjelaskan konsep, dan banyak lagi. Apa yang bisa saya bantu hari ini?
                        </p>
                        <div class="suggestion-cards">
                            <div class="suggestion-card" onclick="sendSuggestion('Buatkan script Roblox fly hack dengan GUI')">
                                <div class="suggestion-card-icon">üéÆ</div>
                                <div class="suggestion-card-text">Buatkan script Roblox fly hack dengan GUI</div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('Jelaskan cara kerja machine learning')">
                                <div class="suggestion-card-icon">üß†</div>
                                <div class="suggestion-card-text">Jelaskan cara kerja machine learning</div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('Buat kode Python untuk web scraping')">
                                <div class="suggestion-card-icon">üêç</div>
                                <div class="suggestion-card-text">Buat kode Python untuk web scraping</div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('Siapa yang membuat RAAI?')">
                                <div class="suggestion-card-icon">üë®‚Äçüíª</div>
                                <div class="suggestion-card-text">Siapa yang membuat RAAI?</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-container">
                        <div class="input-wrapper">
                            <textarea 
                                id="message-input" 
                                placeholder="Ketik pesan..." 
                                rows="1"
                                onkeydown="handleKeyDown(event)"
                                oninput="autoResize(this)"
                            ></textarea>
                        </div>
                        <button class="send-btn" id="send-btn" onclick="sendMessage()">‚û§</button>
                    </div>
                </div>
            </div>

            <!-- Image Generator View -->
            <div class="image-generator-view hidden" id="image-view">
                <div class="image-gen-header">
                    <h2>üé® AI Image Generator</h2>
                    <p>Generate gambar 2D dan 3D menggunakan AI</p>
                </div>

                <div class="image-gen-content">
                    <div class="mode-selector">
                        <button class="mode-btn active" id="mode-2d" onclick="setImageMode('2d')">
                            üñºÔ∏è 2D Art
                        </button>
                        <button class="mode-btn" id="mode-3d" onclick="setImageMode('3d')">
                            üé≤ 3D Render
                        </button>
                    </div>

                    <div class="prompt-input-area">
                        <div class="prompt-input-wrapper">
                            <input 
                                type="text" 
                                class="prompt-input" 
                                id="image-prompt" 
                                placeholder="Deskripsikan gambar yang ingin dibuat..."
                                onkeydown="if(event.key === 'Enter') generateImage()"
                            >
                            <button class="generate-btn" id="generate-btn" onclick="generateImage()">
                                <span id="generate-btn-text">‚ú® Generate</span>
                            </button>
                        </div>
                    </div>

                    <div class="image-gallery" id="image-gallery"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal-overlay hidden" id="admin-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Admin Panel</h2>
                <button class="modal-close-btn" onclick="closeAdminPanel()">‚úï</button>
            </div>

            <!-- Login Form -->
            <div id="admin-login">
                <div class="modal-body">
                    <div class="login-form">
                        <div class="login-icon">üîê</div>
                        <h3>Masukkan Password</h3>
                        <p>Password diperlukan untuk mengakses Admin Panel</p>
                        <div class="password-input-wrapper">
                            <input 
                                type="password" 
                                class="password-input" 
                                id="admin-password" 
                                placeholder="Password..."
                                onkeydown="if(event.key === 'Enter') loginAdmin()"
                            >
                            <button class="password-toggle" onclick="togglePassword()">üëÅÔ∏è</button>
                        </div>
                        <button class="login-btn" onclick="loginAdmin()">üîì Masuk</button>
                        <p class="login-error hidden" id="login-error">Password salah!</p>
                    </div>
                </div>
            </div>

            <!-- Settings Form -->
            <div id="admin-settings" class="hidden">
                <div class="modal-body">
                    <div class="settings-section">
                        <div class="settings-section-title">üè∑Ô∏è Nama Website</div>
                        <input type="text" class="settings-input" id="setting-web-name" placeholder="RAAI">
                        <p class="settings-description">Nama yang tampil di sidebar dan browser tab</p>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">ü§ñ Nama AI</div>
                        <input type="text" class="settings-input" id="setting-ai-name" placeholder="RAAI">
                        <p class="settings-description">Nama yang digunakan AI saat merespons</p>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">üé® Logo</div>
                        <div class="logo-options">
                            <div class="logo-option active" id="logo-emoji-option" onclick="selectLogoOption('emoji')">
                                <div class="logo-option-title">Emoji</div>
                                <div class="emoji-selector">
                                    <button class="emoji-btn active" onclick="selectEmoji('ü§ñ')">ü§ñ</button>
                                    <button class="emoji-btn" onclick="selectEmoji('üß†')">üß†</button>
                                    <button class="emoji-btn" onclick="selectEmoji('‚ö°')">‚ö°</button>
                                    <button class="emoji-btn" onclick="selectEmoji('üöÄ')">üöÄ</button>
                                    <button class="emoji-btn" onclick="selectEmoji('üíé')">üíé</button>
                                    <button class="emoji-btn" onclick="selectEmoji('üîÆ')">üîÆ</button>
                                </div>
                            </div>
                            <div class="logo-option" id="logo-upload-option" onclick="selectLogoOption('upload')">
                                <div class="logo-option-title">Upload Gambar</div>
                                <button class="file-upload-btn" onclick="document.getElementById('logo-file').click()">
                                    üìÅ Pilih File
                                </button>
                                <input type="file" id="logo-file" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">üé® Warna Aksen</div>
                        <div class="color-options">
                            <button class="color-btn active" style="background: linear-gradient(135deg, #a855f7, #06b6d4)" onclick="selectColor('#a855f7', '#06b6d4')"></button>
                            <button class="color-btn" style="background: linear-gradient(135deg, #ec4899, #f97316)" onclick="selectColor('#ec4899', '#f97316')"></button>
                            <button class="color-btn" style="background: linear-gradient(135deg, #22c55e, #06b6d4)" onclick="selectColor('#22c55e', '#06b6d4')"></button>
                            <button class="color-btn" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6)" onclick="selectColor('#3b82f6', '#8b5cf6')"></button>
                            <button class="color-btn" style="background: linear-gradient(135deg, #f59e0b, #ef4444)" onclick="selectColor('#f59e0b', '#ef4444')"></button>
                            <button class="color-btn" style="background: linear-gradient(135deg, #06b6d4, #22d3ee)" onclick="selectColor('#06b6d4', '#22d3ee')"></button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">üëÅÔ∏è Preview</div>
                        <div class="preview-card">
                            <div class="preview-logo" id="preview-logo">ü§ñ</div>
                            <div class="preview-name" id="preview-name">RAAI</div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="logout-btn" onclick="logoutAdmin()">üö™ Logout</button>
                    <button class="save-btn" onclick="saveSettings()">üíæ Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox hidden" id="lightbox" onclick="closeLightbox()">
        <button class="lightbox-close">‚úï</button>
        <img src="" alt="Preview" id="lightbox-img">
    </div>

    <script>
        // ============================================
        // CONFIGURATION & STATE
        // ============================================
        const STORAGE_KEY = 'raai_app_settings_v2';
        const CHATS_KEY = 'raai_chats';
        const IMAGES_KEY = 'raai_images';
        const ADMIN_PASSWORD = 'rajxz09';

        let settings = {
            webName: 'RAAI',
            aiName: 'RAAI',
            logoType: 'emoji',
            logoEmoji: 'ü§ñ',
            logoImage: '',
            primaryColor: '#a855f7',
            secondaryColor: '#06b6d4'
        };

        let chats = [];
        let currentChatId = null;
        let images = [];
        let imageMode = '2d';
        let isGenerating = false;
        let isAdminLoggedIn = false;

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            loadSettings();
            loadChats();
            loadImages();
            applySettings();
            renderChatHistory();
            renderImageGallery();

            if (chats.length === 0) {
                newChat();
            } else {
                currentChatId = chats[0].id;
                renderMessages();
            }
        }

        // ============================================
        // SETTINGS MANAGEMENT
        // ============================================
        function loadSettings() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    settings = { ...settings, ...JSON.parse(saved) };
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        }

        function saveSettingsToStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
                return true;
            } catch (e) {
                console.error('Error saving settings:', e);
                return false;
            }
        }

        function applySettings() {
            // Update CSS variables
            document.documentElement.style.setProperty('--primary', settings.primaryColor);
            document.documentElement.style.setProperty('--secondary', settings.secondaryColor);

            // Update title
            document.title = `${settings.webName} - Advanced AI Assistant`;

            // Update sidebar
            document.getElementById('sidebar-title').textContent = settings.webName;
            document.getElementById('header-ai-name').textContent = settings.aiName;
            document.getElementById('welcome-title').textContent = `Halo! Saya ${settings.aiName}`;

            // Update logos
            const logoHtml = settings.logoType === 'image' && settings.logoImage 
                ? `<img src="${settings.logoImage}" alt="Logo">`
                : settings.logoEmoji;

            document.getElementById('sidebar-logo').innerHTML = logoHtml;
            document.getElementById('welcome-icon').innerHTML = logoHtml;
        }

        // ============================================
        // CHAT MANAGEMENT
        // ============================================
        function loadChats() {
            try {
                const saved = localStorage.getItem(CHATS_KEY);
                if (saved) {
                    chats = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading chats:', e);
            }
        }

        function saveChats() {
            try {
                localStorage.setItem(CHATS_KEY, JSON.stringify(chats));
            } catch (e) {
                console.error('Error saving chats:', e);
            }
        }

        function newChat() {
            const chat = {
                id: Date.now().toString(),
                title: 'Chat Baru',
                messages: [],
                createdAt: new Date().toISOString()
            };
            chats.unshift(chat);
            currentChatId = chat.id;
            saveChats();
            renderChatHistory();
            renderMessages();
        }

        function deleteChat(chatId, event) {
            event.stopPropagation();
            chats = chats.filter(c => c.id !== chatId);
            if (currentChatId === chatId) {
                if (chats.length > 0) {
                    currentChatId = chats[0].id;
                } else {
                    newChat();
                    return;
                }
            }
            saveChats();
            renderChatHistory();
            renderMessages();
        }

        function selectChat(chatId) {
            currentChatId = chatId;
            renderChatHistory();
            renderMessages();
        }

        function getCurrentChat() {
            return chats.find(c => c.id === currentChatId);
        }

        function renderChatHistory() {
            const container = document.getElementById('chat-history');
            container.innerHTML = chats.map(chat => `
                <div class="chat-history-item ${chat.id === currentChatId ? 'active' : ''}" onclick="selectChat('${chat.id}')">
                    <span class="chat-history-title">üí¨ ${chat.title}</span>
                    <button class="chat-delete-btn" onclick="deleteChat('${chat.id}', event)">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // ============================================
        // MESSAGE RENDERING
        // ============================================
        function renderMessages() {
            const chat = getCurrentChat();
            const container = document.getElementById('messages-container');
            const welcomeScreen = document.getElementById('welcome-screen');

            if (!chat || chat.messages.length === 0) {
                welcomeScreen.classList.remove('hidden');
                container.innerHTML = '';
                container.appendChild(welcomeScreen);
                return;
            }

            welcomeScreen.classList.add('hidden');
            container.innerHTML = chat.messages.map(msg => createMessageHTML(msg)).join('');
            container.scrollTop = container.scrollHeight;
        }

        function createMessageHTML(message) {
            const isUser = message.role === 'user';
            const logoHtml = settings.logoType === 'image' && settings.logoImage 
                ? `<img src="${settings.logoImage}" alt="AI">`
                : settings.logoEmoji;

            return `
                <div class="message ${message.role}">
                    <div class="message-avatar">
                        ${isUser ? 'üë§' : logoHtml}
                    </div>
                    <div class="message-bubble">
                        ${formatMessage(message.content)}
                    </div>
                </div>
            `;
        }

        function formatMessage(content) {
            // Escape HTML first
            let html = content
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            // Code blocks with language
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'code';
                const id = 'code-' + Math.random().toString(36).substr(2, 9);
                return `
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-block-lang">${language}</span>
                            <button class="copy-code-btn" onclick="copyCode('${id}', this)">üìã Salin</button>
                        </div>
                        <div class="code-block-content">
                            <pre id="${id}">${code.trim()}</pre>
                        </div>
                    </div>
                `;
            });

            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code class="inline-code">$1</code>');

            // Bold
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

            // Italic
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');

            // Line breaks
            html = html.replace(/\n/g, '<br>');

            return html;
        }

        function copyCode(id, btn) {
            const code = document.getElementById(id).textContent;
            navigator.clipboard.writeText(code).then(() => {
                btn.innerHTML = '‚úÖ Tersalin!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.innerHTML = 'üìã Salin';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // ============================================
        // AI COMMUNICATION
        // ============================================
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message || isGenerating) return;

            input.value = '';
            autoResize(input);

            const chat = getCurrentChat();
            
            // Add user message
            chat.messages.push({ role: 'user', content: message });
            
            // Update chat title if first message
            if (chat.messages.length === 1) {
                chat.title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
            }

            saveChats();
            renderChatHistory();
            renderMessages();

            // Show typing indicator
            isGenerating = true;
            document.getElementById('send-btn').disabled = true;
            showTypingIndicator();

            try {
                const response = await getAIResponse(message, chat.messages);
                chat.messages.push({ role: 'assistant', content: response });
                saveChats();
            } catch (error) {
                chat.messages.push({ 
                    role: 'assistant', 
                    content: 'Maaf, terjadi kesalahan. Silakan coba lagi.' 
                });
                saveChats();
            }

            isGenerating = false;
            document.getElementById('send-btn').disabled = false;
            renderMessages();
        }

        function sendSuggestion(text) {
            document.getElementById('message-input').value = text;
            sendMessage();
        }

        function showTypingIndicator() {
            const container = document.getElementById('messages-container');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message assistant';
            
            const logoHtml = settings.logoType === 'image' && settings.logoImage 
                ? `<img src="${settings.logoImage}" alt="AI">`
                : settings.logoEmoji;

            typingDiv.innerHTML = `
                <div class="message-avatar">${logoHtml}</div>
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        async function getAIResponse(message, history) {
            const lowerMsg = message.toLowerCase();

            // Check for creator question
            if (lowerMsg.includes('siapa') && (lowerMsg.includes('buat') || lowerMsg.includes('cipta') || lowerMsg.includes('pembuat') || lowerMsg.includes('pencipta') || lowerMsg.includes('developer') || lowerMsg.includes('kembang')) && (lowerMsg.includes('raai') || lowerMsg.includes('kamu') || lowerMsg.includes('lo') || lowerMsg.includes('lu'))) {
                return `${settings.aiName} dibuat oleh **rajxzdev** üöÄ

Beliau adalah seorang **solo web developer** yang sangat terampil dan lihai di bidang:

‚Ä¢ üåê **Web Development** ‚Äî Membuat website modern dengan teknologi terkini
‚Ä¢ üéÆ **Game Development** ‚Äî Terutama coding game di platform **Roblox**
‚Ä¢ üíª **Full-Stack Development** ‚Äî Menguasai frontend dan backend

rajxzdev adalah developer berbakat yang membangun ${settings.aiName} dari nol untuk membantu banyak orang! ‚ú®`;
            }

            // Build conversation for API
            const systemPrompt = `Kamu adalah ${settings.aiName}, AI assistant yang sangat cerdas dan membantu.

ATURAN PENTING:
1. JANGAN PERNAH gunakan format LaTeX seperti \\boxed{}, \\frac{}, $...$, \\times dll
2. Untuk matematika, gunakan simbol biasa: x, √∑, ‚àö, =, +, -
3. Contoh BENAR: "5 x 3 = 15" atau "‚àö16 = 4"
4. Contoh SALAH: "\\(5 \\times 3 = \\boxed{15}\\)"
5. Untuk kode, gunakan code block dengan bahasa: \`\`\`lua ... \`\`\`
6. Jawab dalam bahasa yang sama dengan user
7. Berikan jawaban yang jelas, terstruktur, dan mudah dipahami
8. Jika diminta membuat kode, berikan kode yang lengkap dan bisa langsung dijalankan`;

            const messages = [
                { role: 'system', content: systemPrompt },
                ...history.slice(-10).map(m => ({ role: m.role, content: m.content }))
            ];

            const endpoints = [
                {
                    url: 'https://text.pollinations.ai/openai',
                    method: 'POST',
                    body: { model: 'openai-large', messages }
                },
                {
                    url: 'https://text.pollinations.ai/openai',
                    method: 'POST', 
                    body: { model: 'mistral', messages }
                },
                {
                    url: `https://text.pollinations.ai/${encodeURIComponent(systemPrompt + '\n\nUser: ' + message)}`,
                    method: 'GET'
                }
            ];

            for (const endpoint of endpoints) {
                try {
                    const options = {
                        method: endpoint.method,
                        headers: { 'Content-Type': 'application/json' }
                    };
                    if (endpoint.body) {
                        options.body = JSON.stringify(endpoint.body);
                    }

                    const response = await fetch(endpoint.url, options);
                    if (!response.ok) continue;

                    let text = await response.text();
                    text = cleanResponse(text);
                    
                    if (text && text.length > 10) {
                        return text;
                    }
                } catch (e) {
                    console.error('API Error:', e);
                    continue;
                }
            }

            return 'Maaf, saya sedang mengalami gangguan. Silakan coba lagi dalam beberapa saat.';
        }

        function cleanResponse(text) {
            // Try to parse as JSON first
            try {
                const json = JSON.parse(text);
                if (json.choices?.[0]?.message?.content) {
                    text = json.choices[0].message.content;
                } else if (json.content) {
                    text = json.content;
                } else if (json.message) {
                    text = json.message;
                } else if (json.text) {
                    text = json.text;
                } else if (json.response) {
                    text = json.response;
                }
            } catch (e) {
                // Not JSON, use as is
            }

            // Clean LaTeX
            text = text
                .replace(/\\\[([\s\S]*?)\\\]/g, '$1')
                .replace(/\\\(([\s\S]*?)\\\)/g, '$1')
                .replace(/\$\$([\s\S]*?)\$\$/g, '$1')
                .replace(/\$([^$]+)\$/g, '$1')
                .replace(/\\boxed\{([^}]*)\}/g, '$1')
                .replace(/\\frac\{([^}]*)\}\{([^}]*)\}/g, '($1/$2)')
                .replace(/\\sqrt\{([^}]*)\}/g, '‚àö($1)')
                .replace(/\\times/g, '√ó')
                .replace(/\\div/g, '√∑')
                .replace(/\\pm/g, '¬±')
                .replace(/\\neq/g, '‚â†')
                .replace(/\\leq/g, '‚â§')
                .replace(/\\geq/g, '‚â•')
                .replace(/\\approx/g, '‚âà')
                .replace(/\\infty/g, '‚àû')
                .replace(/\\pi/g, 'œÄ')
                .replace(/\\alpha/g, 'Œ±')
                .replace(/\\beta/g, 'Œ≤')
                .replace(/\\sum/g, 'Œ£')
                .replace(/\\prod/g, 'Œ†')
                .replace(/\\int/g, '‚à´')
                .replace(/\\[a-zA-Z]+\{([^}]*)\}/g, '$1')
                .replace(/\\[a-zA-Z]+/g, '')
                .replace(/\{([^}]*)\}/g, '$1');

            // Remove ads and unwanted content
            const adPatterns = [
                /\[.*?pollinations.*?\]/gi,
                /powered by pollinations/gi,
                /generated by pollinations/gi,
                /pollinations\.ai/gi,
                /\{"role":"assistant".*?"tool_calls":\[\]\}/g,
                /"reasoning_content":"[^"]*"/g,
                /"tool_calls":\[\]/g
            ];

            for (const pattern of adPatterns) {
                text = text.replace(pattern, '');
            }

            return text.trim();
        }

        // ============================================
        // IMAGE GENERATION
        // ============================================
        function loadImages() {
            try {
                const saved = localStorage.getItem(IMAGES_KEY);
                if (saved) {
                    images = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading images:', e);
            }
        }

        function saveImages() {
            try {
                // Only save metadata, not the actual image URLs (they're from Pollinations)
                const toSave = images.slice(0, 20); // Keep last 20
                localStorage.setItem(IMAGES_KEY, JSON.stringify(toSave));
            } catch (e) {
                console.error('Error saving images:', e);
            }
        }

        function setImageMode(mode) {
            imageMode = mode;
            document.getElementById('mode-2d').classList.toggle('active', mode === '2d');
            document.getElementById('mode-3d').classList.toggle('active', mode === '3d');
        }

        async function generateImage() {
            const input = document.getElementById('image-prompt');
            const prompt = input.value.trim();
            if (!prompt || isGenerating) return;

            isGenerating = true;
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.innerHTML = '<div class="generating-spinner"></div> Generating...';

            try {
                const stylePrompt = imageMode === '3d' 
                    ? `3D render, highly detailed, octane render, 8k, ${prompt}`
                    : `digital art, illustration, detailed, ${prompt}`;

                const seed = Math.floor(Math.random() * 1000000);
                const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(stylePrompt)}?width=512&height=512&seed=${seed}&nologo=true`;

                // Preload image
                await new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = resolve;
                    img.onerror = reject;
                    img.src = imageUrl;
                });

                const imageData = {
                    id: Date.now().toString(),
                    url: imageUrl,
                    prompt: prompt,
                    mode: imageMode,
                    createdAt: new Date().toISOString()
                };

                images.unshift(imageData);
                saveImages();
                renderImageGallery();
                input.value = '';

            } catch (error) {
                alert('Gagal generate gambar. Silakan coba lagi.');
            }

            isGenerating = false;
            btn.disabled = false;
            btn.innerHTML = '‚ú® Generate';
        }

        function renderImageGallery() {
            const gallery = document.getElementById('image-gallery');
            gallery.innerHTML = images.map(img => `
                <div class="gallery-item">
                    <img class="gallery-image" src="${img.url}" alt="${img.prompt}" onclick="openLightbox('${img.url}')">
                    <div class="gallery-info">
                        <div class="gallery-prompt">${img.prompt}</div>
                        <div class="gallery-actions">
                            <button class="gallery-action-btn" onclick="downloadImage('${img.url}', '${img.prompt}')">
                                ‚¨áÔ∏è Download
                            </button>
                            <button class="gallery-action-btn" onclick="regenerateImage('${img.prompt}', '${img.mode}')">
                                üîÑ Regenerate
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function downloadImage(url, prompt) {
            const a = document.createElement('a');
            a.href = url;
            a.download = `${prompt.substring(0, 30)}.png`;
            a.target = '_blank';
            a.click();
        }

        function regenerateImage(prompt, mode) {
            document.getElementById('image-prompt').value = prompt;
            setImageMode(mode);
            generateImage();
        }

        function openLightbox(url) {
            document.getElementById('lightbox-img').src = url;
            document.getElementById('lightbox').classList.remove('hidden');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.add('hidden');
        }

        // ============================================
        // UI CONTROLS
        // ============================================
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function switchView(view) {
            document.getElementById('nav-chat').classList.toggle('active', view === 'chat');
            document.getElementById('nav-image').classList.toggle('active', view === 'image');
            document.getElementById('chat-view').classList.toggle('hidden', view !== 'chat');
            document.getElementById('image-view').classList.toggle('hidden', view !== 'image');
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        }

        // ============================================
        // ADMIN PANEL
        // ============================================
        function openAdminPanel() {
            document.getElementById('admin-modal').classList.remove('hidden');
            if (isAdminLoggedIn) {
                showAdminSettings();
            } else {
                showAdminLogin();
            }
        }

        function closeAdminPanel() {
            document.getElementById('admin-modal').classList.add('hidden');
        }

        function showAdminLogin() {
            document.getElementById('admin-login').classList.remove('hidden');
            document.getElementById('admin-settings').classList.add('hidden');
            document.getElementById('admin-password').value = '';
            document.getElementById('login-error').classList.add('hidden');
        }

        function showAdminSettings() {
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('admin-settings').classList.remove('hidden');
            
            // Populate form
            document.getElementById('setting-web-name').value = settings.webName;
            document.getElementById('setting-ai-name').value = settings.aiName;
            updatePreview();
        }

        function loginAdmin() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                showAdminSettings();
            } else {
                const errorEl = document.getElementById('login-error');
                errorEl.classList.remove('hidden');
                errorEl.style.animation = 'none';
                setTimeout(() => errorEl.style.animation = 'shake 0.5s ease', 10);
            }
        }

        function logoutAdmin() {
            isAdminLoggedIn = false;
            showAdminLogin();
        }

        function togglePassword() {
            const input = document.getElementById('admin-password');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function selectLogoOption(option) {
            document.getElementById('logo-emoji-option').classList.toggle('active', option === 'emoji');
            document.getElementById('logo-upload-option').classList.toggle('active', option === 'upload');
            settings.logoType = option;
            updatePreview();
        }

        function selectEmoji(emoji) {
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === emoji);
            });
            settings.logoEmoji = emoji;
            settings.logoType = 'emoji';
            updatePreview();
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (max 100MB)
            if (file.size > 100 * 1024 * 1024) {
                alert('File terlalu besar! Maksimal 100MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                // Compress image
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const maxSize = 200;
                    let width = img.width;
                    let height = img.height;

                    if (width > height && width > maxSize) {
                        height = (height * maxSize) / width;
                        width = maxSize;
                    } else if (height > maxSize) {
                        width = (width * maxSize) / height;
                        height = maxSize;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    settings.logoImage = canvas.toDataURL('image/jpeg', 0.8);
                    settings.logoType = 'image';
                    selectLogoOption('upload');
                    updatePreview();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function selectColor(primary, secondary) {
            document.querySelectorAll('.color-btn').forEach(btn => {
                const bg = btn.style.background;
                btn.classList.toggle('active', bg.includes(primary));
            });
            settings.primaryColor = primary;
            settings.secondaryColor = secondary;
            updatePreview();
        }

        function updatePreview() {
            const previewLogo = document.getElementById('preview-logo');
            const previewName = document.getElementById('preview-name');

            if (settings.logoType === 'image' && settings.logoImage) {
                previewLogo.innerHTML = `<img src="${settings.logoImage}" alt="Logo">`;
            } else {
                previewLogo.innerHTML = settings.logoEmoji;
            }

            previewLogo.style.background = `linear-gradient(135deg, ${settings.primaryColor}, ${settings.secondaryColor})`;
            previewName.textContent = document.getElementById('setting-web-name').value || settings.webName;
            previewName.style.background = `linear-gradient(135deg, ${settings.primaryColor}, ${settings.secondaryColor})`;
            previewName.style.webkitBackgroundClip = 'text';
            previewName.style.webkitTextFillColor = 'transparent';
        }

        function saveSettings() {
            settings.webName = document.getElementById('setting-web-name').value || 'RAAI';
            settings.aiName = document.getElementById('setting-ai-name').value || 'RAAI';

            if (saveSettingsToStorage()) {
                applySettings();
                closeAdminPanel();
                alert('‚úÖ Settings berhasil disimpan!');
            } else {
                alert('‚ùå Gagal menyimpan settings. Coba kurangi ukuran logo.');
            }
        }

        // Initialize app
        init();
    </script>
</body>
</html>
